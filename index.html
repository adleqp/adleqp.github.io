<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BountyScan — Bug Bounty Helper (Static Demo)</title>
  <style>
    :root{
      --bg:#070a0f;
      --panel:#0d1420;
      --panel2:#0b101a;
      --text:#e6eefc;
      --muted:#99a7c2;
      --accent:#5ef7c5;
      --accent2:#7aa7ff;
      --danger:#ff5d6c;
      --warn:#ffd166;
      --ok:#5ef7c5;
      --line:rgba(255,255,255,.08);
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(900px 600px at 10% -10%, rgba(94,247,197,.22), transparent 55%),
        radial-gradient(900px 600px at 90% 0%, rgba(122,167,255,.20), transparent 55%),
        radial-gradient(900px 700px at 50% 120%, rgba(255,93,108,.14), transparent 55%),
        var(--bg);
      min-height:100vh;
    }
    a{color:inherit}
    .wrap{
      max-width:1180px;
      margin:0 auto;
      padding:28px 18px 60px;
    }
    header{
      display:flex;
      gap:16px;
      justify-content:space-between;
      align-items:center;
      padding:16px 18px;
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(13,20,32,.85), rgba(11,16,26,.75));
      box-shadow:var(--shadow);
      border-radius:var(--radius);
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex;align-items:center;gap:12px;
    }
    .logo{
      width:42px;height:42px;border-radius:12px;
      background:
        radial-gradient(circle at 30% 30%, rgba(94,247,197,.95), rgba(94,247,197,.05) 55%),
        radial-gradient(circle at 70% 70%, rgba(122,167,255,.85), rgba(122,167,255,.02) 55%),
        #0c1220;
      border:1px solid rgba(255,255,255,.10);
      box-shadow:0 10px 30px rgba(94,247,197,.12);
      position:relative;
    }
    .logo:after{
      content:"";
      position:absolute;inset:10px 9px 9px 10px;
      border-radius:10px;
      border:1px dashed rgba(255,255,255,.25);
      opacity:.7;
    }
    h1{font-size:16px;margin:0}
    .sub{font-size:12px;color:var(--muted);margin-top:2px}
    .pillrow{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .pill{
      font-family:var(--mono);
      font-size:11px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--muted);
    }
    .pill strong{color:var(--text)}
    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:16px;
      margin-top:16px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .pillrow{justify-content:flex-start}
    }
    .card{
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(13,20,32,.80), rgba(11,16,26,.72));
      box-shadow:var(--shadow);
      border-radius:var(--radius);
      padding:16px;
      backdrop-filter: blur(10px);
    }
    .card h2{
      font-size:14px;
      margin:0 0 10px;
      letter-spacing:.2px;
    }
    .help{
      font-size:12px;color:var(--muted);line-height:1.55;margin:8px 0 0;
    }
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .field{
      flex:1;
      min-width:220px;
    }
    label{
      display:block;font-size:12px;color:var(--muted);
      margin-bottom:6px;
    }
    input, select, textarea{
      width:100%;
      border:1px solid var(--line);
      border-radius:14px;
      padding:11px 12px;
      background:rgba(0,0,0,.22);
      color:var(--text);
      outline:none;
      font-family:var(--sans);
    }
    textarea{min-height:86px;resize:vertical}
    input:focus, select:focus, textarea:focus{
      border-color: rgba(94,247,197,.55);
      box-shadow:0 0 0 4px rgba(94,247,197,.12);
    }
    .actions{
      display:flex;gap:10px;flex-wrap:wrap;
      margin-top:12px;align-items:center;
    }
    button{
      border:none;
      border-radius:14px;
      padding:11px 13px;
      font-weight:600;
      cursor:pointer;
      color:#071018;
      background:linear-gradient(135deg, var(--accent), rgba(94,247,197,.65));
      box-shadow:0 12px 30px rgba(94,247,197,.15);
    }
    button.secondary{
      color:var(--text);
      background:rgba(255,255,255,.05);
      border:1px solid var(--line);
      box-shadow:none;
    }
    button.danger{
      color: #1b0a0c;
      background:linear-gradient(135deg, var(--danger), rgba(255,93,108,.6));
      box-shadow:0 12px 30px rgba(255,93,108,.12);
    }
    button:disabled{
      opacity:.6; cursor:not-allowed;
    }
    .progress{
      margin-top:12px;
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
      background:rgba(255,255,255,.03);
      height:12px;
    }
    .bar{
      height:100%;
      width:0%;
      background:linear-gradient(90deg, var(--accent2), var(--accent));
      transition:width .25s ease;
    }
    .kpis{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:10px;
      margin-top:14px;
    }
    @media (max-width: 980px){
      .kpis{grid-template-columns:repeat(2,1fr)}
    }
    .kpi{
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      border-radius:16px;
      padding:12px;
    }
    .kpi .num{
      font-family:var(--mono);
      font-size:18px;
      margin:2px 0 6px;
    }
    .kpi .lbl{font-size:11px;color:var(--muted)}
    .badge{
      font-family:var(--mono);
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      display:inline-flex;
      gap:6px;
      align-items:center;
      background:rgba(255,255,255,.03);
      color:var(--muted);
    }
    .dot{width:8px;height:8px;border-radius:50%}
    .dot.ok{background:var(--ok)}
    .dot.warn{background:var(--warn)}
    .dot.bad{background:var(--danger)}
    .table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius:14px;
      border:1px solid var(--line);
      margin-top:12px;
    }
    .table th, .table td{
      padding:10px 10px;
      text-align:left;
      font-size:12px;
      border-bottom:1px solid var(--line);
      vertical-align:top;
    }
    .table th{
      color:var(--muted);
      font-weight:600;
      background:rgba(255,255,255,.03);
    }
    .table tr:last-child td{border-bottom:none}
    .sev{
      font-family:var(--mono);
      font-size:11px;
      padding:3px 8px;border-radius:999px;
      border:1px solid var(--line);
      display:inline-block;
    }
    .sev.high{background:rgba(255,93,108,.12); color:#ffd2d7; border-color:rgba(255,93,108,.35)}
    .sev.med{background:rgba(255,209,102,.12); color:#ffe9bf; border-color:rgba(255,209,102,.35)}
    .sev.low{background:rgba(122,167,255,.10); color:#d7e6ff; border-color:rgba(122,167,255,.30)}
    .sev.info{background:rgba(94,247,197,.08); color:#c9fff0; border-color:rgba(94,247,197,.26)}
    .mono{font-family:var(--mono)}
    .muted{color:var(--muted)}
    .split{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }
    .tip{
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px;
      background:rgba(0,0,0,.15);
    }
    .tip h3{margin:0 0 6px;font-size:13px}
    .tip p{margin:0;color:var(--muted);font-size:12px;line-height:1.55}
    .footer{
      margin-top:16px;
      font-size:12px;
      color:var(--muted);
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:space-between;
      align-items:center;
    }
    .kbd{
      font-family:var(--mono);
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      border-radius:8px;
      padding:2px 6px;
      color:var(--text);
    }
    .hidden{display:none !important}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>BountyScan <span class="muted">/ static bug bounty demo</span></h1>
          <div class="sub">Authorized scanning only • Works fully offline • Exports a report</div>
        </div>
      </div>
      <div class="pillrow">
        <div class="pill"><strong>Mode:</strong> Static (No backend)</div>
        <div class="pill"><strong>Scope:</strong> Your own URLs</div>
        <div class="pill"><strong>Hotkey:</strong> <span class="kbd">F</span> toggle panel</div>
      </div>
    </header>

    <div class="grid">
      <!-- Left: Scanner -->
      <section class="card" id="panel">
        <h2>Scan Center</h2>
        <div class="row">
          <div class="field">
            <label for="target">Target URL</label>
            <input id="target" placeholder="https://yourusername.github.io" autocomplete="off" />
            <div class="help">
              Tip: On GitHub Pages, use your own site. Cross-origin restrictions mean the browser can’t fetch headers from most external sites.
            </div>
          </div>
          <div class="field">
            <label for="profile">Profile</label>
            <select id="profile">
              <option value="quick">Quick (best for demo)</option>
              <option value="headers">Headers & TLS hints</option>
              <option value="frontend">Frontend checks</option>
              <option value="full">Full (simulated)</option>
            </select>
            <div class="help">
              Static scanning here is safe: it does not exploit anything. It focuses on best practices + client-side signals.
            </div>
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="field">
            <label for="notes">Notes (optional)</label>
            <textarea id="notes" placeholder="Describe what you’re testing and why (for your report)."></textarea>
          </div>
        </div>

        <div class="actions">
          <button id="btnScan">Run Scan</button>
          <button class="secondary" id="btnDemo">Use Demo Target</button>
          <button class="secondary" id="btnExport" disabled>Export JSON Report</button>
          <button class="danger" id="btnReset">Reset</button>
          <span class="help" id="statusText" style="margin:0">Idle.</span>
        </div>

        <div class="progress" aria-label="scan progress">
          <div class="bar" id="bar"></div>
        </div>

        <div class="kpis">
          <div class="kpi">
            <div class="badge"><span class="dot bad"></span> High</div>
            <div class="num" id="kHigh">0</div>
            <div class="lbl">Critical security gaps</div>
          </div>
          <div class="kpi">
            <div class="badge"><span class="dot warn"></span> Medium</div>
            <div class="num" id="kMed">0</div>
            <div class="lbl">Should fix soon</div>
          </div>
          <div class="kpi">
            <div class="badge"><span class="dot"></span> Low</div>
            <div class="num" id="kLow">0</div>
            <div class="lbl">Hardening items</div>
          </div>
          <div class="kpi">
            <div class="badge"><span class="dot ok"></span> Info</div>
            <div class="num" id="kInfo">0</div>
            <div class="lbl">Observations</div>
          </div>
        </div>

        <table class="table" id="resultsTable" aria-label="scan results">
          <thead>
            <tr>
              <th style="width:110px">Severity</th>
              <th>Finding</th>
              <th style="width:240px">Where</th>
            </tr>
          </thead>
          <tbody id="resultsBody">
            <tr>
              <td class="muted" colspan="3">No results yet. Run a scan.</td>
            </tr>
          </tbody>
        </table>

        <div class="footer">
          <div>⚠️ Use only on websites you own or have permission to test.</div>
          <div class="mono muted" id="runtime"></div>
        </div>
      </section>

      <!-- Right: Tips / Remediation -->
      <aside class="card">
        <h2>Fix Tips Library</h2>
        <div class="help">These tips are general hardening guidance. Each finding will link here with practical steps.</div>

        <div class="split" id="tips">
          <!-- Filled by JS -->
        </div>

        <div class="help" style="margin-top:12px">
          Want real scanning (headers, crawling, passive analysis across sites)? You’ll need a backend runner (e.g., ZAP baseline) because browsers block cross-origin inspection.
        </div>
      </aside>
    </div>
  </div>

  <script>
    // ==========================
    // Static Bug Bounty Demo
    // ==========================
    const $ = (id) => document.getElementById(id);

    const els = {
      panel: $("panel"),
      target: $("target"),
      profile: $("profile"),
      notes: $("notes"),
      btnScan: $("btnScan"),
      btnDemo: $("btnDemo"),
      btnExport: $("btnExport"),
      btnReset: $("btnReset"),
      statusText: $("statusText"),
      bar: $("bar"),
      resultsBody: $("resultsBody"),
      kHigh: $("kHigh"),
      kMed: $("kMed"),
      kLow: $("kLow"),
      kInfo: $("kInfo"),
      runtime: $("runtime"),
      tips: $("tips"),
    };

    const TIP_LIBRARY = [
      {
        id: "csp",
        title: "Content Security Policy (CSP)",
        desc: "Add a CSP header to reduce XSS risk by restricting where scripts/styles can load from.",
        steps: [
          "Start with a report-only policy and review violations.",
          "Then enforce: default-src 'self'; script-src 'self'; object-src 'none'; base-uri 'self'; frame-ancestors 'none'",
          "Avoid unsafe-inline; use nonces/hashes for inline scripts."
        ]
      },
      {
        id: "headers",
        title: "Security Headers",
        desc: "Harden browser behavior with standard headers.",
        steps: [
          "Set: X-Content-Type-Options: nosniff",
          "Set: Referrer-Policy: strict-origin-when-cross-origin",
          "Set: Permissions-Policy to disable unused APIs",
          "Set: X-Frame-Options: DENY (or use CSP frame-ancestors)"
        ]
      },
      {
        id: "https",
        title: "HTTPS + HSTS",
        desc: "Serve over HTTPS and enforce it with HSTS to prevent downgrade attacks.",
        steps: [
          "Enable HTTPS everywhere",
          "Add: Strict-Transport-Security: max-age=31536000; includeSubDomains; preload",
          "Ensure redirects from http → https"
        ]
      },
      {
        id: "deps",
        title: "Frontend Dependencies",
        desc: "Avoid outdated libraries and risky third-party scripts.",
        steps: [
          "Pin versions (no floating latest)",
          "Avoid loading scripts from unknown CDNs",
          "Use SRI (Subresource Integrity) for external scripts",
          "Audit dependencies regularly"
        ]
      },
      {
        id: "forms",
        title: "Secure Forms & Inputs",
        desc: "Reduce injection and data leakage risks at the UI layer.",
        steps: [
          "Validate inputs client-side AND server-side",
          "Use autocomplete carefully (e.g., off for sensitive fields)",
          "Never reflect raw user input into HTML (avoid innerHTML)"
        ]
      },
      {
        id: "storage",
        title: "Token Storage",
        desc: "Prevent token theft by avoiding localStorage for sensitive auth tokens.",
        steps: [
          "Prefer HttpOnly, Secure cookies for session tokens",
          "Short token lifetimes and refresh rotation",
          "Apply SameSite=strict/lax appropriately"
        ]
      }
    ];

    function renderTips(){
      els.tips.innerHTML = TIP_LIBRARY.map(t => `
        <div class="tip" id="tip-${t.id}">
          <h3>${escapeHtml(t.title)}</h3>
          <p>${escapeHtml(t.desc)}</p>
          <ul style="margin:8px 0 0; padding-left:18px; color: var(--muted); font-size:12px; line-height:1.55">
            ${t.steps.map(s => `<li>${escapeHtml(s)}</li>`).join("")}
          </ul>
        </div>
      `).join("");
    }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
      }[m]));
    }

    // --- Findings model ---
    let lastReport = null;

    function setStatus(msg){
      els.statusText.textContent = msg;
    }
    function setProgress(pct){
      els.bar.style.width = Math.max(0, Math.min(100, pct)) + "%";
    }
    function setKpis(findings){
      const counts = {high:0, med:0, low:0, info:0};
      for(const f of findings) counts[f.severity]++;
      els.kHigh.textContent = counts.high;
      els.kMed.textContent = counts.med;
      els.kLow.textContent = counts.low;
      els.kInfo.textContent = counts.info;
    }

    function renderFindings(findings){
      if(!findings.length){
        els.resultsBody.innerHTML = `<tr><td class="muted" colspan="3">No findings.</td></tr>`;
        return;
      }
      els.resultsBody.innerHTML = findings.map(f => `
        <tr>
          <td><span class="sev ${f.severity}">${f.severity.toUpperCase()}</span></td>
          <td>
            <div style="font-weight:650">${escapeHtml(f.title)}</div>
            <div class="muted" style="margin-top:4px; line-height:1.4">${escapeHtml(f.summary)}</div>
            <div style="margin-top:6px">
              ${f.tipId ? `<a href="#tip-${f.tipId}" class="badge" style="text-decoration:none">Fix tip: ${escapeHtml(f.tipId)}</a>` : ""}
            </div>
          </td>
          <td class="mono muted">${escapeHtml(f.where || "-")}</td>
        </tr>
      `).join("");
    }

    // --- "Static scan" checks ---
    // Because of browser security, we mostly analyze:
    // 1) Your current page (if scanning self)
    // 2) URL patterns
    // 3) Known frontend signals (meta tags, mixed content in DOM, etc.)
    // 4) Simulated results to show UI flow
    function normalizeUrl(u){
      try{
        const url = new URL(u);
        return url.toString();
      }catch(e){
        return null;
      }
    }

    function isSameOrigin(targetUrl){
      try{
        const t = new URL(targetUrl);
        return t.origin === location.origin;
      }catch{ return false; }
    }

    function checkFrontendSelf(findings){
      // Only meaningful if scanning same origin page
      // CSP cannot be read via JS reliably; but we can check for common risky patterns.

      // 1) Mixed content: http assets on https page
      const mixed = [...document.querySelectorAll('img[src],script[src],link[href]')]
        .map(el => el.getAttribute('src') || el.getAttribute('href'))
        .filter(Boolean)
        .filter(x => x.startsWith("http://"));
      if(location.protocol === "https:" && mixed.length){
        findings.push({
          severity: "high",
          title: "Mixed content detected",
          summary: "Some assets are loaded over HTTP on an HTTPS page. This can allow content tampering.",
          where: mixed.slice(0,4).join(", ") + (mixed.length>4?` (+${mixed.length-4} more)`:""),
          tipId: "https"
        });
      }

      // 2) Inline scripts (can increase XSS risk unless CSP nonces/hashes used)
      const inlineScripts = [...document.querySelectorAll("script:not([src])")].filter(s => (s.textContent||"").trim().length>0);
      if(inlineScripts.length){
        findings.push({
          severity: "med",
          title: "Inline scripts present",
          summary: "Inline scripts can make CSP harder and increase XSS impact. Prefer external scripts or CSP nonces/hashes.",
          where: `${inlineScripts.length} inline <script> tag(s) found`,
          tipId: "csp"
        });
      }

      // 3) Use of innerHTML patterns (very rough heuristic)
      const hasInnerHtmlHint = (document.documentElement.innerHTML.includes("innerHTML") ||
                                document.documentElement.innerHTML.includes("insertAdjacentHTML"));
      if(hasInnerHtmlHint){
        findings.push({
          severity: "low",
          title: "Potential unsafe DOM injection pattern",
          summary: "Avoid injecting untrusted data into HTML (innerHTML/insertAdjacentHTML). Use textContent and sanitize inputs.",
          where: "Static heuristic (review code)",
          tipId: "forms"
        });
      }

      // 4) Autocomplete on password fields
      const pw = document.querySelector('input[type="password"]');
      if(pw && pw.autocomplete && pw.autocomplete.toLowerCase() !== "new-password"){
        findings.push({
          severity: "info",
          title: "Password field autocomplete setting",
          summary: "Review autocomplete attributes on sensitive fields to avoid unintended credential storage.",
          where: "input[type=password]",
          tipId: "forms"
        });
      }
    }

    function urlBasedChecks(targetUrl, findings){
      const u = new URL(targetUrl);

      if(u.protocol !== "https:"){
        findings.push({
          severity: "high",
          title: "Target is not HTTPS",
          summary: "HTTPS is strongly recommended. Without it, traffic can be intercepted or modified.",
          where: targetUrl,
          tipId: "https"
        });
      } else {
        findings.push({
          severity: "info",
          title: "HTTPS detected",
          summary: "Good. Next step: add HSTS and secure headers (requires server config).",
          where: targetUrl,
          tipId: "headers"
        });
      }

      // Query params hinting sensitive data
      const sensitiveKeys = ["token","apikey","api_key","key","password","passwd","session","auth"];
      const qp = [...u.searchParams.keys()].map(k => k.toLowerCase());
      const bad = qp.filter(k => sensitiveKeys.includes(k));
      if(bad.length){
        findings.push({
          severity: "med",
          title: "Sensitive data in URL parameters",
          summary: "Avoid placing secrets in URLs; they can leak via logs, referrers, and browser history.",
          where: `?${bad.join("&")}...`,
          tipId: "storage"
        });
      }

      // GitHub Pages note
      if(u.hostname.endsWith(".github.io")){
        findings.push({
          severity: "info",
          title: "GitHub Pages hosting detected",
          summary: "GitHub Pages is static. Some headers (CSP/HSTS) are limited unless you use a reverse proxy/CDN.",
          where: u.hostname,
          tipId: "headers"
        });
      }
    }

    function simulatedChecks(profile, findings){
      // To make the demo feel real, we add optional simulated items (non-exploit).
      if(profile === "quick") return;

      if(profile === "headers" || profile === "full"){
        findings.push({
          severity: "med",
          title: "Missing or weak security headers (cannot verify in static mode)",
          summary: "In a full scanner, we’d verify CSP, HSTS, X-Content-Type-Options, Referrer-Policy, Permissions-Policy.",
          where: "Requires backend header inspection",
          tipId: "headers"
        });
      }

      if(profile === "frontend" || profile === "full"){
        findings.push({
          severity: "low",
          title: "Third-party script risk review recommended",
          summary: "Review any third-party scripts and add Subresource Integrity (SRI) where possible.",
          where: "Script/CDN review",
          tipId: "deps"
        });
      }

      if(profile === "full"){
        findings.push({
          severity: "info",
          title: "Passive crawling would be run here (backend required)",
          summary: "A real platform would crawl allowed pages, map endpoints, and collect passive issues safely.",
          where: "Backend feature",
          tipId: "csp"
        });
      }
    }

    async function runScan(){
      const started = performance.now();
      const raw = els.target.value.trim();
      const normalized = normalizeUrl(raw);
      if(!normalized){
        setStatus("Please enter a valid URL (include https://).");
        return;
      }

      // Safety reminder: don’t scan random sites
      // In static mode we can't actually scan remote headers anyway, but still:
      // encourage authorized use.
      setStatus("Running checks…");
      els.btnScan.disabled = true;
      els.btnExport.disabled = true;
      setProgress(5);

      const findings = [];

      // Step 1: URL checks
      await sleep(250);
      setProgress(18);
      urlBasedChecks(normalized, findings);

      // Step 2: If same-origin, inspect DOM
      await sleep(300);
      setProgress(45);
      if(isSameOrigin(normalized)){
        checkFrontendSelf(findings);
      } else {
        findings.push({
          severity: "info",
          title: "Cross-origin limitations (browser sandbox)",
          summary: "This static demo cannot fetch headers or crawl most external sites due to CORS. Use your own site or add a backend runner later.",
          where: new URL(normalized).origin,
          tipId: "headers"
        });
      }

      // Step 3: Simulated (non-exploit) checks depending on profile
      await sleep(350);
      setProgress(70);
      simulatedChecks(els.profile.value, findings);

      // Step 4: Sort by severity order
      await sleep(250);
      setProgress(92);

      const order = {high:0, med:1, low:2, info:3};
      findings.sort((a,b)=> (order[a.severity] ?? 9) - (order[b.severity] ?? 9));

      renderFindings(findings);
      setKpis(findings);

      const finished = performance.now();
      const secs = ((finished - started)/1000).toFixed(2);
      els.runtime.textContent = `Runtime: ${secs}s • ${new Date().toLocaleString()}`;
      setProgress(100);

      lastReport = buildReport(normalized, findings);

      els.btnExport.disabled = false;
      els.btnScan.disabled = false;
      setStatus(`Done. Found ${findings.length} item(s).`);
    }

    function buildReport(targetUrl, findings){
      const now = new Date();
      return {
        tool: "BountyScan (Static Demo)",
        mode: "static-html-css-js",
        generated_at: now.toISOString(),
        target: targetUrl,
        profile: els.profile.value,
        notes: els.notes.value || "",
        authorized_use_only: true,
        findings: findings.map(f => ({
          severity: f.severity,
          title: f.title,
          summary: f.summary,
          where: f.where || "",
          tip_id: f.tipId || ""
        })),
        next_steps: [
          "For real header checks and crawling, add a backend runner (e.g., ZAP baseline) and require target ownership verification.",
          "Fix issues, redeploy, and rescan to verify improvements."
        ]
      };
    }

    function exportJson(){
      if(!lastReport) return;
      const blob = new Blob([JSON.stringify(lastReport, null, 2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `bountyscan-report-${Date.now()}.json`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(a.href);
    }

    function resetAll(){
      els.target.value = "";
      els.notes.value = "";
      setProgress(0);
      setKpis([]);
      els.resultsBody.innerHTML = `<tr><td class="muted" colspan="3">No results yet. Run a scan.</td></tr>`;
      lastReport = null;
      els.btnExport.disabled = true;
      setStatus("Idle.");
      els.runtime.textContent = "";
    }

    function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

    // Hotkey F = toggle panel visibility (like your request earlier)
    window.addEventListener("keydown", (e) => {
      if(e.key.toLowerCase() === "f" && !e.repeat){
        els.panel.classList.toggle("hidden");
      }
    });

    els.btnScan.addEventListener("click", runScan);
    els.btnExport.addEventListener("click", exportJson);
    els.btnReset.addEventListener("click", resetAll);
    els.btnDemo.addEventListener("click", () => {
      // Demo target uses current origin so DOM checks work.
      els.target.value = location.origin + location.pathname;
      setStatus("Demo target set to this page (same-origin).");
    });

    renderTips();
    resetAll();
  </script>
</body>
</html>
